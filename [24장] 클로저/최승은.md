
# 24ì¥ í´ë¡œì € (Closure)

> **ì •ì˜**: *í´ë¡œì €ëŠ” í•¨ìˆ˜ì™€ ê·¸ í•¨ìˆ˜ê°€ ì„ ì–¸ëœ ë ‰ì‹œì»¬ í™˜ê²½ì˜ ì¡°í•©*ì´ë‹¤. (MDN)
> ì¦‰, **í•¨ìˆ˜ê°€ ìƒì„±ë  ë•Œì˜ ìŠ¤ì½”í”„ë¥¼ ê¸°ì–µí•˜ëŠ” ëŠ¥ë ¥**.

---

## 24.1 ë ‰ì‹œì»¬ ìŠ¤ì½”í”„ (Lexical Scope)

* ìë°”ìŠ¤í¬ë¦½íŠ¸ëŠ” \*\*ë ‰ì‹œì»¬ ìŠ¤ì½”í”„(ì •ì  ìŠ¤ì½”í”„)\*\*ë¥¼ ë”°ë¥¸ë‹¤.
* ì¦‰, í•¨ìˆ˜ì˜ ìƒìœ„ ìŠ¤ì½”í”„ëŠ” \*\*"í•¨ìˆ˜ë¥¼ ì–´ë””ì„œ í˜¸ì¶œí–ˆëŠ”ì§€"ê°€ ì•„ë‹ˆë¼ "í•¨ìˆ˜ë¥¼ ì–´ë””ì„œ ì •ì˜í–ˆëŠ”ì§€"\*\*ë¡œ ê²°ì •ëœë‹¤.
* ìƒìœ„ ìŠ¤ì½”í”„ëŠ” **í•¨ìˆ˜ ì •ì˜ ì‹œì ì— ì •ì ìœ¼ë¡œ ê²°ì •**ë˜ê³  ì´í›„ ë³€í•˜ì§€ ì•ŠëŠ”ë‹¤.

### ì˜ˆì‹œ

```js
const x = 1;

function outerFunc() {
  const x = 10;
  function innerFunc() {
    console.log(x); // 10
  }
  innerFunc();
}
outerFunc();
```

* `innerFunc`ëŠ” **ì •ì˜ëœ ìœ„ì¹˜** ê¸°ì¤€ìœ¼ë¡œ `outerFunc`ì˜ ë ‰ì‹œì»¬ í™˜ê²½ì„ ìƒìœ„ ìŠ¤ì½”í”„ë¡œ ê¸°ì–µí•œë‹¤.
* í˜¸ì¶œ ìœ„ì¹˜(`outerFunc`)ê°€ ì•„ë‹ˆë¼ **ì •ì˜ ìœ„ì¹˜**ê°€ ì¤‘ìš”í•˜ë‹¤.

---

## 24.2 í•¨ìˆ˜ ê°ì²´ì˜ ë‚´ë¶€ ìŠ¬ë¡¯ \[\[Environment]]

* ëª¨ë“  í•¨ìˆ˜ ê°ì²´ëŠ” `[[Environment]]` ë‚´ë¶€ ìŠ¬ë¡¯ì— \*\*ìì‹ ì´ ì •ì˜ëœ ë ‰ì‹œì»¬ í™˜ê²½ì˜ ì°¸ì¡°(=ìƒìœ„ ìŠ¤ì½”í”„)\*\*ë¥¼ ì €ì¥í•œë‹¤.
* ì´ ë•ë¶„ì— í•¨ìˆ˜ëŠ” **í˜¸ì¶œë  ë•Œë§ˆë‹¤ ìƒìœ„ ìŠ¤ì½”í”„ë¥¼ ë‹¤ì‹œ íƒìƒ‰**í•  ìˆ˜ ìˆë‹¤.

### í•¨ìˆ˜ ì‹¤í–‰ ê³¼ì • ìš”ì•½

1. **í•¨ìˆ˜ ì •ì˜ í‰ê°€**

   * í•¨ìˆ˜ ê°ì²´ê°€ ìƒì„±ë  ë•Œ, `[[Environment]]`ì— \*\*ì •ì˜ëœ í™˜ê²½(ìƒìœ„ ìŠ¤ì½”í”„)\*\*ë¥¼ ì €ì¥.
2. **í•¨ìˆ˜ í˜¸ì¶œ ì‹œ**

   * ìƒˆë¡œìš´ í•¨ìˆ˜ ë ‰ì‹œì»¬ í™˜ê²½ ìƒì„±
   * ì´ ë ‰ì‹œì»¬ í™˜ê²½ì˜ "ì™¸ë¶€ ë ‰ì‹œì»¬ í™˜ê²½ ì°¸ì¡°"ê°€ `[[Environment]]`ì— ì €ì¥ëœ ìƒìœ„ ìŠ¤ì½”í”„ë¥¼ ê°€ë¦¬í‚´.

---

## 24.3 í´ë¡œì €ì™€ ë ‰ì‹œì»¬ í™˜ê²½

* **í´ë¡œì €**: ì™¸ë¶€ í•¨ìˆ˜ì˜ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ê°€ ì¢…ë£Œëœ ë’¤ì—ë„, ë‚´ë¶€ í•¨ìˆ˜ê°€ ì™¸ë¶€ ë³€ìˆ˜(ììœ  ë³€ìˆ˜)ë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆëŠ” í˜„ìƒ.

```js
function outer() {
  const x = 10;
  return function inner() {
    console.log(x); // outerì˜ ë³€ìˆ˜ì— ì ‘ê·¼ ê°€ëŠ¥
  };
}

const innerFunc = outer();
innerFunc(); // 10
```

### ë™ì‘ ì›ë¦¬

1. `outer` ì‹¤í–‰ â†’ `outer`ì˜ ë ‰ì‹œì»¬ í™˜ê²½ ìƒì„±
2. `inner` ì •ì˜ ì‹œ â†’ `[[Environment]]`ì— `outer`ì˜ ë ‰ì‹œì»¬ í™˜ê²½ ì €ì¥
3. `outer` ì‹¤í–‰ ì¢…ë£Œ í›„ ì»¨í…ìŠ¤íŠ¸ ì œê±° â†’ í•˜ì§€ë§Œ ë ‰ì‹œì»¬ í™˜ê²½ì€ `inner`ê°€ ì°¸ì¡° ì¤‘ì´ë¯€ë¡œ GC ëŒ€ìƒ ì•„ë‹˜
4. `inner` í˜¸ì¶œ ì‹œ â†’ `outer`ì˜ ë ‰ì‹œì»¬ í™˜ê²½ì„ ê¸°ì–µí•˜ê³  ì ‘ê·¼ ê°€ëŠ¥

---

### ğŸ”‘ í´ë¡œì € ì¡°ê±´

* ì¤‘ì²© í•¨ìˆ˜ê°€ \*\*ìƒìœ„ ìŠ¤ì½”í”„ì˜ ì‹ë³„ì(ììœ  ë³€ìˆ˜)\*\*ë¥¼ ì°¸ì¡°í•œë‹¤.
* ì¤‘ì²© í•¨ìˆ˜ê°€ ì™¸ë¶€ í•¨ìˆ˜ë³´ë‹¤ ì˜¤ë˜ ì‚´ì•„ë‚¨ëŠ”ë‹¤.

ì¦‰, **ìƒíƒœ ìœ ì§€ + ì€ë‹‰**ì´ ê°€ëŠ¥í•œ í•¨ìˆ˜ë§Œ í´ë¡œì €ë¡œ ì·¨ê¸‰í•œë‹¤.

---

## 24.4 í´ë¡œì €ì˜ í™œìš©

### 1) ìƒíƒœ ìœ ì§€ì™€ ì€ë‹‰

```js
const increase = (function () {
  let num = 0; // ì€ë‹‰ëœ ë³€ìˆ˜
  return function () {
    return ++num;
  };
})();
console.log(increase()); // 1
console.log(increase()); // 2
```

* `num`ì€ ì™¸ë¶€ì—ì„œ ì§ì ‘ ì ‘ê·¼ ë¶ˆê°€
* ì˜¤ì§ ë°˜í™˜ëœ í•¨ìˆ˜ë§Œ `num`ì„ ë³€ê²½ ê°€ëŠ¥

---

### 2) ëª¨ë“ˆ íŒ¨í„´

```js
const Counter = (function () {
  let num = 0;

  return {
    increase() {
      return ++num;
    },
    decrease() {
      return num > 0 ? --num : 0;
    },
  };
})();

console.log(Counter.increase()); // 1
console.log(Counter.decrease()); // 0
```

* ê°ì²´ì˜ **ë©”ì„œë“œë§Œ ì ‘ê·¼ ê°€ëŠ¥**, ë‚´ë¶€ ìƒíƒœ(`num`)ëŠ” ì€ë‹‰ë¨

---

### 3) ê³ ì°¨ í•¨ìˆ˜ í™œìš©

```js
function makeCounter(aux) {
  let counter = 0;
  return function () {
    counter = aux(counter);
    return counter;
  };
}

const increaser = makeCounter((n) => ++n);
const decreaser = makeCounter((n) => --n);

console.log(increaser()); // 1
console.log(increaser()); // 2
console.log(decreaser()); // -1
```

* í•¨ìˆ˜í˜• í”„ë¡œê·¸ë˜ë°ì—ì„œ ìƒíƒœ ë³€ê²½ ë¡œì§ì„ \*\*ë³´ì¡° í•¨ìˆ˜(aux)\*\*ë¡œ ë¶„ë¦¬ ê°€ëŠ¥
* ë¶ˆë³€ì„±ì„ ìœ ì§€í•˜ë©´ì„œë„ ìƒíƒœë¥¼ ìº¡ìŠí™”í•  ìˆ˜ ìˆìŒ

---

## 24.5 ìº¡ìŠí™”ì™€ ì •ë³´ ì€ë‹‰

* **ìº¡ìŠí™”**: í”„ë¡œí¼í‹° + ë©”ì„œë“œë¥¼ ë¬¶ëŠ” ê²ƒ
* **ì •ë³´ ì€ë‹‰**: íŠ¹ì • ë°ì´í„°(ìƒíƒœ)ë¥¼ ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ëª»í•˜ê²Œ ë³´í˜¸

### ì˜ˆì‹œ (í´ë¡œì €ë¡œ private êµ¬í˜„)

```js
function Person(name, age) {
  this.name = name;
  let _age = age; // private

  this.sayHi = function () {
    console.log(`Hi! I am ${this.name}, ${_age} years old.`);
  };
}

const me = new Person("Lee", 20);
me.sayHi(); // ì ‘ê·¼ ê°€ëŠ¥
console.log(me._age); // undefined (ì€ë‹‰ë¨)
```

âš ï¸ ë‹¨ì : ì¸ìŠ¤í„´ìŠ¤ë§ˆë‹¤ `sayHi`ê°€ ì¤‘ë³µ ìƒì„±ë¨
â¡ï¸ í”„ë¡œí† íƒ€ì… ë©”ì„œë“œë¡œ ë¹¼ë©´ `age`ì— ì ‘ê·¼ ë¶ˆê°€ â†’ í´ë¡œì €ì™€ í”„ë¡œí† íƒ€ì…ì€ í•¨ê»˜ ì“°ê¸° ì–´ë ¤ì›€

---

### ğŸ’¡ ìµœì‹  JS ë¬¸ë²•: `#private` í•„ë“œ

```js
class Person {
  #age; // private

  constructor(name, age) {
    this.name = name;
    this.#age = age;
  }

  sayHi() {
    console.log(`Hi! I am ${this.name}, ${this.#age} years old.`);
  }
}
```

* ES2022 í‘œì¤€ â†’ ì™„ì „í•œ ì •ë³´ ì€ë‹‰ ì§€ì›

---

## 24.6 í´ë¡œì € ì‚¬ìš© ì‹œ ìì£¼ ë°œìƒí•˜ëŠ” ì‹¤ìˆ˜

### ë¬¸ì œ ìƒí™© (var ì‚¬ìš©)

```js
var funcs = [];

for (var i = 0; i < 3; i++) {
  funcs[i] = function () {
    return i;
  };
}
console.log(funcs[0]()); // 3
console.log(funcs[1]()); // 3
console.log(funcs[2]()); // 3
```

* `var`ëŠ” í•¨ìˆ˜ ë ˆë²¨ ìŠ¤ì½”í”„ â†’ `i`ê°€ ì „ì—­ì—ì„œ ê³µìœ ë¨
* ëª¨ë“  í•¨ìˆ˜ê°€ **ìµœì¢… ê°’ 3**ì„ ì°¸ì¡°

---

### í•´ê²° ë°©ë²•

1. **ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜(IIFE)ë¡œ í´ë¡œì € ë§Œë“¤ê¸°**

```js
for (var i = 0; i < 3; i++) {
  funcs[i] = (function (id) {
    return function () {
      return id;
    };
  })(i);
}
```

2. **`let` ì‚¬ìš© (ë¸”ë¡ ìŠ¤ì½”í”„)**

```js
for (let i = 0; i < 3; i++) {
  funcs[i] = function () {
    return i;
  };
}
```

3. **ê³ ì°¨ í•¨ìˆ˜ ì‚¬ìš©**

```js
const funcs = Array.from({ length: 3 }, (_, i) => () => i);
funcs.forEach((f) => console.log(f())); // 0 1 2
```

ğŸ‘‰ ìŠ¹ì€ ë‹˜ ë…¸íŠ¸ì— ë”± ë§ê²Œ **ë©´ì ‘ ì§ˆë¬¸ ì˜ˆìƒ í¬ì¸íŠ¸**ë„ ë”°ë¡œ ì •ë¦¬í•´ë“œë¦´ê¹Œìš”? (ì˜ˆ: "í´ë¡œì €ë€ ë¬´ì—‡ì¸ê°€ìš”?", "ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ í´ë¡œì € í™œìš© ì‚¬ë¡€?", "varì™€ letì˜ í´ë¡œì € ì°¨ì´ì ?")
